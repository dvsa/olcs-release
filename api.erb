<?php

/**
 * Local Configuration Override
 *
 * This configuration override file is for overriding environment-specific and
 * security-sensitive configuration information. Copy this file without the
 * .dist extension at the end and populate values as needed.
 *
 * @NOTE: This file is ignored from Git by default with the .gitignore included
 * in ZendSkeletonApplication. This is a good practice, as it prevents sensitive
 * credentials from accidentally being committed into version control.
 */

$doctrine_connection_params = [
    // *Environment specific*
    'host' => 'olcsdb-rds.<%= @domain %>',
    // *Environment specific*
    'port' => '3306',
    // *Environment specific*
    'user' => 'olcsapi',
    // *Environment specific*
    'password' => '<%= @olcs_api_rds_password %>',
    // *Environment specific*
    'dbname' => 'OLCS_RDS_OLCSDB',
];

return [
    // Postcode/Address service
    'address' => [
        'client' => [
            // URI e.g. http://postcode.cit.olcs.mgt.mtpdvsa/ *Environment specific*
            'baseuri' => 'http://address.<%= @domain %>/'
        ]
    ],

    // Elastic search
    'elastic_search' => [
        // Hostname e.g. elasticsearch-dev.olcs.mgt.mtpdvsa *Environment specific*
        'host' => 'search.<%= @domain %>',
        // Port, e.g. 9200
        'port' => '9200'
    ],

    // Doctrine
    'doctrine' => [
        'connection' => [
            'orm_default' => [
                'driverClass' => \Doctrine\DBAL\Driver\PDOMySql\Driver::class,
                // Database connection details
                'params' => $doctrine_connection_params,
            ],
            'export' => [
                'driverClass' => \Doctrine\DBAL\Driver\PDOMySql\Driver::class,
                'params' => $doctrine_connection_params +
                    [
                        'driverOptions' => [
                            PDO::MYSQL_ATTR_USE_BUFFERED_QUERY => false,
                            PDO::CURSOR_FWDONLY => true,
                        ],
                    ],
            ],
        ],
        'driver' => [
            'EntityDriver' => [
                'cache' => 'apc'
            ],
            'translatable_metadata_driver' => [
                'cache' => 'apc',
            ]
        ],
        'configuration' => [
            'orm_default' => [
                'metadata_cache' => 'apc'
                // Log SQL queries to the OLCS application log file
                //'sql_logger' => 'DoctrineLogger',
            ]
        ],
    ],

    // Companies house XML gateway credentials
    'companies_house_credentials' => [
        // Companies house XML gateway userID *Environment specific*
        'userId' => '<%= @olcs_companieshousexmluserid %>',
        // Companies house XML gateway password *Environment specific*
        'password' => '<%= olcs_companieshousexmlpassword %>',
    ],

    // Set the following if you need to go via a proxy to get to Companies house XML gateway
    // *Environment specific*
    'companies_house_connection' => [
        'proxy' => "<%= scope.function_hiera(['shd_proxy']) %>"
    ],

    // Document service
    'document_share' => [
        'client' => [
            // Document service URI *Environment specific*
            'baseuri' => "<%= scope.function_hiera(['olcs_docman']) %>",
            // Document service user ID *Environment specific*
            'uuid' => 'uD12345',
            // Document service workspace "olcs"
            'workspace' => 'olcs'
        ],
    ],

    // Asset path, URI to olcs-static (CSS, JS, etc) *Environment specific*
    'asset_path' => '/static/public',

    // Companies house RESTful API
    'companies_house' => [
        'http' => [
            // Set the following if you need to go via a proxy to get to Companies House RESTful API
            // *Environment specific*
            'curloptions' => [
                CURLOPT_PROXY => "http://<%= scope.function_hiera(['shd_proxy']) %>",
                // Companies House API key followed by a colon
                CURLOPT_USERPWD => "<%= olcs_companieshouseapikey %>:",
            ],
        ],
        'auth' => [
            // Companies House API key (register one at https://developer.companieshouse.gov.uk/] *Environment specific*
            'username' => "<%= olcs_companieshouseapikey %>",
            // Leave this empty
            'password' => '',
        ],
        'client' => [
            'baseuri' => 'https://api.companieshouse.gov.uk/',
        ],
    ],

    // CPMS service
    'cpms_api' => [
        'logger_alias' => 'Logger', // Zend logger service manager alias - use 'Logger' for the main OLCS log
        'identity_provider' => 'CpmsIdentityProvider', // Should implement CpmsClient\Authenticate\IdentityProviderInterface
        'enable_cache' => true,
        'cache_storage' => 'array',
        'rest_client' => [
            'options' => [
                //CPMS API version to use
                'version' => 2,
                // CPMS hostname e.g. 'payment-service.psqa-ap01.ps.npm' *Environment specific*
                'domain' => "<%= scope.function_hiera(['olcs_cpmsserver']) %>",
            ],
        ],
    ],

    // CPMS service authentication - used by CpmsIdentityProvider service
    'cpms_credentials' => [
        // CPMS user ID *Environment specific*
        // (this can be left as is, will be deprecated in the future once authentication is implemented)
        'user_id' => '1234',
        // CPMS client ID *Environment specific*
        'client_id' => 'OLCS',
        // CPMS Client secret *Environment specific*
        'client_secret' => "<%= scope.function_hiera(['olcs_cpmssecret']) %>"
    ],

    // Email config
    'email' => [
        // Debugging option forces all email to be sent to an address
        // Selfserve/external URI e.g. http://demo_dvsa-selfserve.web03.olcs.mgt.mtpdvsa *Environment specific*
        'send_all_mail_to' => '<%= scope.function_hiera(['olcs_send_all_mail_to']) %>',
        'from_name' => 'OLCS do not reply',
        'from_email' => '<%= @olcs_from_email %>',
        'selfserve_uri' => '<%= @olcs_ss_uri %>',
        'internal_uri' => '<%= @olcs_iu_uri %>',
    ],

    'mail' => [],
    'mailboxes' => [
        // IMAP connection to a the mailbox for reading inspection request emails
        'inspection_request' => [
            // IMAP hostname *Environment specific*
            'host' => '<%= @olcs_imap_host %>',
            // IMAP user *Environment specific*
            'user' => '<%= @olcs_imap_user %>',
            // IMAP password *Environment specific*
            'password' => '<%= @olcs_imap_password %>',
            // IMAP port 993 *Environment specific*
            'port' => <%= @olcs_imap_port %>,
            // SSL (0 or 1)
            'ssl' => '<%= @olcs_imap_ssl %>',
        ],
    ],

    // AUTH config
    'openam' => [
        'username' => 'olcs_app',
        'password' => '<%= @olcs_api_opendj_password %>',
        'uri' => 'http://dir.<%= @domain %>:8080',
        'pid_header' => 'X-Pid'
    ],

    'ebsr' => [
        'transexchange_publisher' => [
            'uri' => 'http://localhost:8080/txc/publisherService', // @NOTE CHANGEME
            'options' => [
                'timeout' => 30
            ]
        ],
        'tmp_extra_path' => '/EBSR-tmp', //extra path to ebsr files within /tmp
        //debug only - validation must always be set to true in production
        'validate' => [
            'xml_structure' => true,
            'bus_registration' => true,
            'processed_data' => true,
            'short_notice' => true
        ]
    ],

    'nr' => [
        // @to-do currently waiting on the actual nr address
        'inr_service' => [
            'uri' => '<%= @olcs_natreg_uri %>',
            'options' => [
                'timeout' => 30,
                'adapter'   => 'Zend\Http\Client\Adapter\Curl',
                'curloptions' => [
                    CURLOPT_SSL_VERIFYPEER => 1, //debug only, must be set to 1 in production
                    CURLOPT_SSL_VERIFYHOST => 2, //debug only, must be set to 2 in production
                    // file name of the National Register client certificate
                    CURLOPT_CAINFO => '/etc/ssl/certs/atos-ca1.pem'
                ]
            ]
        ],
        'repute_url' => [
            'uri' => '<%= @olcs_natreg_repute %>'
        ],
    ],

    'print' => [
        'server' => 'print.<%= @olcs_shd %>:631'
    ],

    /**
     * Configure the location of the application log
     */
    'log' => [
        'Logger' => [
            'writers' => [
                'full' => [
                    'options' => [
                        'stream' => '/var/log/dvsa/olcs-api/api.log',
                        'filters' => [
                            'priority' => [
                                'name' => 'priority',
                                'options' => [
                                    'priority' => \Zend\Log\Logger::DEBUG
                                ]
                            ],
                        ]
                    ],
                ]
            ]
        ],
        'ExceptionLogger' => [
            'writers' => [
                'full' => [
                    'options' => [
                        'stream' => '/var/log/dvsa/olcs-api/api.log',
                        'filters' => [
                            'priority' => [
                                'name' => 'priority',
                                'options' => [
                                    'priority' => \Zend\Log\Logger::DEBUG
                                ]
                            ],
                        ]
                    ],
                ]
            ]
        ]
    ],

    // Path to VI extract data
    'vi_extract_files' => [
        'export_path' => '/tmp/ViExtract'
    ],

    // Path to export CSV data for data.gov.uk
    'data-gov-uk-export' => [
        'path' => '/tmp/dataGovUk',
    ],

    // Path to export CSV data for Companies House differences
    'ch-vs-olcs-export' => [
        'path' => '/tmp/companyHouse_vs_Olcs',
    ],

    // Nysiis SOAP configuration
    'nysiis' => [
        'wsdl' => [
            'uri' => '<%= @olcs_nysiis_uri %>?WSDL',
            'soap' => [
                'options' => [
                    'soap_version' => SOAP_1_2,
                    'cache_wsdl' => 0,
                    'location' => '<%= @olcs_nysiis_uri %>',
                    'uri' => '<%= @olcs_nysiis_uri %>',
                    'encoding' => 'UTF-8',
                    'exceptions' => true
                ]
            ]
        ]
    ]
];
